using Flux, CUDA, Functors, ProgressMeter

mutable struct Autoencoder
    encoder
    decoder
    loader::Flux.DataLoader
    opt::Flux.Optimiser
    loss::Function
    epochs::Integer
end
@functor Autoencoder (encoder,decoder)

function (Î±::Autoencoder)(X)
    return Chain(Î±.encoder,Î±.decoder)(X)
end


function encoderlayers(m::Integer,d::Integer,l::Integer,Ïƒ=relu)
    #dims = size(X)
    #m = prod(dims[1:(length(dims)-1)])
    s = div(d-m,l)
    ğ = m:s:d
    #ğ = vcat(ğ,reverse(ğ[1:length(ğ)-1]))
    Î¸ = foldl(ğ[3:length(ğ)],
              init=Chain(Dense(ğ[1] => ğ[2],Ïƒ))) do layers,d
        d_0 = size(layers[length(layers)].weight)[1]
        return Chain(layers...,Dense(d_0 => d,Ïƒ))
    end
end
    
